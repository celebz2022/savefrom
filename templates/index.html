<!DOCTYPE html>
<html>
<head>
    <title>Instagram Video Downloader</title>
</head>
<body>
<h2>Instagram Video Downloader</h2>
<input type="text" id="url" placeholder="Paste Instagram link here" size="50"/>
<button onclick="downloadVideo()">Download</button>

<p id="message" style="color:red;"></p>

<script>
const affiliateLink = "{{ affiliate_link }}"; // Injected by Flask

function downloadVideo() {
    document.getElementById("message").innerText = "";
    let url = document.getElementById("url").value;

    fetch("/download", {
        method: "POST",
        headers: {"Content-Type": "application/json"},
        body: JSON.stringify({url})
    })
    .then(res => res.json())
    .then(data => {
        if(data.error){
            document.getElementById("message").innerText = data.error;
            return;
        }

        // Open Amazon affiliate link in new tab
        window.open(affiliateLink, "_blank");

        // Trigger video download
        const a = document.createElement("a");
        a.href = data.download_url;
        a.download = data.title + ".mp4";
        document.body.appendChild(a);
        a.click();
        a.remove();
    });
}
</script>
</body>
</html>
